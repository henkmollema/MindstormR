@{
    ViewBag.Title = "Home Page";
}

<style>
    html, body { height: 100%; width: 100%; margin: 0; }
    .container { height: 90%; width: 100%; }
    #controls { height: 90%; width: 50%; }
    #sensors { height: 90%; width: 45%; }
</style>

<div class="container">
    <div id="controls" class="pull-right">
        <a href="#" data-command="forward"><img src="~/Content/Images/arrow_up.png" class="img-responsive" style="width: 30%; position: relative; left: 24%; top: 5%;" /></a>
        <a href="#" data-command="left"><img src="~/Content/Images/arrow_left.png" class="img-responsive pull-left" style="width: 30%; position: relative;" /></a>
        <a href="#" data-command="right"><img src="~/Content/Images/arrow_right.png" class="img-responsive pull-left" style="width: 30%; position: relative; left: 18%;" /></a>
        <a href="#" data-command="backward"><img src="~/Content/Images/arrow_down.png" class="img-responsive" style="width: 30%; position: relative; left: -36%; top: 20%;" /></a>
        <a href="#" data-command="fire"><img src="~/Content/Images/engine.png" class="img-responsive" style="width: 30%; position: relative; top: 0%; left: 54%" /></a>
    </div>
    <div id="sensors">
        <br />
        <table class="table">
            <thead>
                <tr>
                    <th>Sensor</th>
                    <th>Waarde</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Sensor 1</td>
                    <td>Waarde 1</td>
                </tr>
                <tr>
                    <td>Sensor 2</td>
                    <td>Waarde 2</td>
                </tr>
                <tr>
                    <td>Sensor 3</td>
                    <td>Waarde 3</td>
                </tr>
                <tr>
                    <td>Sensor 4</td>
                    <td>Waarde 4</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


@section scripts
{
<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script type="text/javascript">

    var robotId = -1;
    $('#logout').hide();
    CreateDropdown();

    window.setInterval(function () {
        CreateDropdown();
    }, 5000);



    function CreateDropdown() {
        $.ajax({
            cache: false,
            url: 'http://test.henkmollema.nl/robot/all',
            dataType: 'jsonp',
            success: function (data) {
                $('#robots').html('');
                for (var i in data) {
                    $('#robots').append('<li role="presentation"><a href="#" data-id="' + data[i] + '" role="menuitem">' + 'Robot ' + data[i] + '</a></li>');
                }
                if (data[0] == null) {
                    $('#robots').append('<li role="presentation" class="disabled"><a role="menuitem">Er zijn geen robots online</a></li>');
                }
            }
        });
    };

    $(function () {
        $('#robots').on('click', 'a', function () {
            robotId = $(this).data('id');
            if (robotId == null) {
                robotId = -1;
            }
            else {
                $('#dropdown-title').html('Robot ' + robotId);
                $('#logout').show();
            }
        });

        function pushControl(command) {
            if (robotId == -1) {
                window.alert('Selecteer eerst een robot!');
            }
            else {
                $.post(
                '@Url.Action("ControlClick", "Home")',
                {
                    'id': robotId,
                    'command': command
                });
            }
        }

        $('#controls').on('click', 'a', function () {
            var command = $(this).data('command');
            pushControl(command);
        });

        $('html').keypress(function (event) {
            switch(event.keyCode) {
                case 37:
                    pushControl('left');
                    break;
                case 38:
                    pushControl('forward');
                    break;
                case 39:
                    pushControl('right');
                    break;
                case 40:
                    pushControl('backward');
                    break;
                case 0:
                    if (event.charCode == 32) {
                        pushControl('fire');
                    }
                    break;
            } 
        });

        $('#logout').on('click', 'a', function () {
            $.get('http://test.henkmollema.nl/robot/' + robotId + '/logout');
            robotId = -1;
            setTimeout(function () { location.reload(true) }, 300);
        });
    });
</script>
}

